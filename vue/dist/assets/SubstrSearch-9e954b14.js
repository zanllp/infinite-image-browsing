import{c as a,A as Ee,d as He,bk as Pe,az as Ge,r as w,ak as Ke,bo as se,s as Le,bq as je,br as qe,aH as Ne,R as Je,T as We,bp as ne,bs as Qe,p as Xe,o as u,j as z,x as t,y as e,k as d,l as i,t as o,v as _,m as v,z as G,bA as Ye,Q as F,F as oe,B as ie,C as Ze,O as et,V as re,$ as ue,as as tt,Z as at,bB as lt,X as st,bw as nt,Y as ot,a4 as it,at as rt,au as ut,bC as dt,n as pt}from"./index-840caa07.js";/* empty css              *//* empty css              */import{s as ct,F as ft}from"./FileItem-f1712134.js";import{M as vt,L as mt,R as gt,f as _t}from"./MultiSelectKeep-002ccaa9.js";import{c as ht,u as yt}from"./hook-585b5d04.js";import{g as kt,o as bt}from"./index-e670b2ef.js";import{f as U,H as de,_ as wt,a as St}from"./searchHistory-490af431.js";import"./index-77c608f4.js";import"./shortcut-38b7c0ce.js";import"./_isIterateeCall-70a3012d.js";var Ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"}},{tag:"path",attrs:{d:"M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"}}]},name:"aim",theme:"outlined"};const xt=Ct;function pe(p){for(var c=1;c<arguments.length;c++){var h=arguments[c]!=null?Object(arguments[c]):{},k=Object.keys(h);typeof Object.getOwnPropertySymbols=="function"&&(k=k.concat(Object.getOwnPropertySymbols(h).filter(function(m){return Object.getOwnPropertyDescriptor(h,m).enumerable}))),k.forEach(function(m){It(p,m,h[m])})}return p}function It(p,c,h){return c in p?Object.defineProperty(p,c,{value:h,enumerable:!0,configurable:!0,writable:!0}):p[c]=h,p}var K=function(c,h){var k=pe({},c,h.attrs);return a(Ee,pe({},k,{icon:xt}),null)};K.displayName="AimOutlined";K.inheritAttrs=!1;const $t=K,At="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",L=p=>(rt("data-v-9726dd9e"),p=p(),ut(),p),Rt={style:{"padding-right":"16px"}},Ot=L(()=>d("div",null,null,-1)),Tt=["title"],Mt=["src"],zt={class:"search-bar"},Ft={class:"form-name"},Ut={class:"search-bar last actions"},Vt={class:"hint"},Dt={key:0,style:{margin:"64px 16px 32px",padding:"8px",background:"var(--zp-secondary-variant-background)","border-radius":"16px"}},Bt={style:{margin:"16px 32px 16px"}},Et={style:{"padding-right":"16px"}},Ht=L(()=>d("div",null,null,-1)),Pt=L(()=>d("div",{style:{padding:"16px 0 512px"}},null,-1)),Gt={key:2,class:"preview-switch"},Kt=He({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{}},setup(p){const c=p,h=Pe(),k=Ge("iib_auto_update_feature_tip_shown",!1),m=w(!1),S=w(""),A=w(!1),C=w(c.searchScope??""),x=w(!1),j=w(0),I=w("all"),V=ht(l=>{const s={cursor:l,regexp:m.value?S.value:"",surstr:m.value?"":S.value,path_only:A.value,folder_paths:(C.value??"").split(/,|\n/).map(r=>r.trim()).filter(r=>r),media_type:I.value};return dt(s)}),{queue:b,images:g,onContextMenuClickU:q,stackViewEl:ce,previewIdx:$,previewing:N,onPreviewVisibleChange:fe,previewImgMove:J,canPreview:W,itemSize:Q,gridItems:ve,showGenInfo:R,imageGenInfo:X,q:me,multiSelectedIdxs:D,onFileItemClick:ge,scroller:Y,showMenuIdx:B,onFileDragStart:_e,onFileDragEnd:he,cellWidth:ye,onScroll:Z,saveAllFileAsJson:ke,saveLoadedFileAsJson:be,props:we,changeIndchecked:Se,seedChangeChecked:Ce,getGenDiff:xe,getGenDiffWatchDep:Ie}=yt(V),f=w();Ke(async()=>{f.value=await se(),f.value.img_count&&f.value.expired&&T.autoUpdateIndex&&await E(),c.searchScope&&await O()}),Le(()=>c,async l=>{we.value=l},{deep:!0,immediate:!0});const E=je(()=>b.pushAction(async()=>(await qe(),f.value=await se(),h.tagMap.clear(),f.value)).res),ee=l=>{S.value=l.substr,C.value=l.folder_paths_str,m.value=l.isRegex,I.value=l.mediaType||"all",x.value=!1,O()},O=async()=>{j.value++,U.value.add({substr:S.value,folder_paths_str:C.value,isRegex:m.value,mediaType:I.value}),await V.reset({refetch:!0}),await Ne(),Z(),Y.value.scrollToItem(0),g.value.length||Je.info(We("fuzzy-search-noResults"))};ne("returnToIIB",async()=>{const l=await b.pushAction(Qe).res;f.value.expired=l.expired}),ne("searchIndexExpired",()=>f.value&&(f.value.expired=!0));const $e=()=>{m.value=!m.value},T=Xe(),{onClearAllSelected:Ae,onSelectAll:Re,onReverseSelect:Oe}=kt();return(l,s)=>{const r=wt,y=St,Te=re,M=ue,te=tt,Me=at,H=lt,ze=st,P=ue,Fe=nt,Ue=ot,Ve=re,De=it;return u(),z(oe,null,[a(Te,{visible:x.value,"onUpdate:visible":s[0]||(s[0]=n=>x.value=n),width:"70vw","mask-closable":"",onOk:s[1]||(s[1]=n=>x.value=!1)},{default:t(()=>[a(de,{records:e(U),onReuseRecord:ee},{default:t(({record:n})=>[d("div",Rt,[a(y,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(u(),_(y,{key:0},{default:t(()=>[a(r,{span:4},{default:t(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):v("",!0),a(y,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),n.mediaType?(u(),_(y,{key:1},{default:t(()=>[a(r,{span:4},{default:t(()=>[i(o(l.$t("mediaType"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[i(o(n.mediaType),1)]),_:2},1024)]),_:2},1024)):v("",!0),a(y,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[i(o(l.$t("time"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),Ot])]),_:1},8,["records"])]),_:1},8,["visible"]),d("div",{class:"container",ref_key:"stackViewEl",ref:ce},[e(k)?v("",!0):(u(),_(te,{key:0,type:"info","show-icon":"",message:l.$t("autoUpdateFeatureTip"),style:{margin:"8px"},closable:"",onClose:s[3]||(s[3]=n=>k.value=!0)},{action:t(()=>[a(M,{size:"small",type:"link",onClick:s[2]||(s[2]=n=>k.value=!0)},{default:t(()=>[i(o(l.$t("gotIt")),1)]),_:1})]),_:1},8,["message"])),f.value&&f.value.expired&&!e(T).autoUpdateIndex?(u(),_(te,{key:1,type:"warning","show-icon":"",message:l.$t("indexExpiredManualUpdate"),style:{margin:"8px"},closable:""},null,8,["message"])):v("",!0),a(vt,{show:!!e(D).length||e(T).keepMultiSelect,onClearAllSelected:e(Ae),onSelectAll:e(Re),onReverseSelect:e(Oe)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),d("div",{class:"search-bar",onKeydown:s[9]||(s[9]=G(()=>{},["stop"]))},[a(Me,{value:S.value,"onUpdate:value":s[4]||(s[4]=n=>S.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(b).isIdle,onKeydown:Ye(O,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),a(ze,{value:I.value,"onUpdate:value":s[5]||(s[5]=n=>I.value=n),style:{width:"100px",margin:"0 4px"},disabled:!e(b).isIdle},{default:t(()=>[a(H,{value:"all"},{default:t(()=>[i(o(l.$t("all")),1)]),_:1}),a(H,{value:"image"},{default:t(()=>[i(o(l.$t("image")),1)]),_:1}),a(H,{value:"video"},{default:t(()=>[i(o(l.$t("video")),1)]),_:1})]),_:1},8,["value","disabled"]),d("div",{class:F(["regex-icon",{selected:A.value}]),onKeydown:s[6]||(s[6]=G(()=>{},["stop"])),onClick:s[7]||(s[7]=n=>A.value=!A.value),title:l.$t("pathOnly")},[a(e($t))],42,Tt),d("div",{class:F(["regex-icon",{selected:m.value}]),onKeydown:s[8]||(s[8]=G(()=>{},["stop"])),onClick:$e,title:"Use Regular Expression"},[d("img",{src:e(At)},null,8,Mt)],34),f.value&&!f.value.img_count?(u(),_(P,{key:0,onClick:e(E),loading:!e(b).isIdle,type:"primary"},{default:t(()=>[i(o(l.$t("generateIndexHint")),1)]),_:1},8,["onClick","loading"])):(u(),z(oe,{key:1},[a(P,{type:"primary",onClick:O,loading:!e(b).isIdle||e(V).loading},{default:t(()=>[i(o(l.$t("search")),1)]),_:1},8,["loading"]),f.value&&f.value.expired&&!e(T).autoUpdateIndex?(u(),_(P,{key:0,onClick:e(E),loading:!e(b).isIdle,style:{"margin-left":"8px"}},{default:t(()=>[i(o(l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):v("",!0)],64))],32),d("div",zt,[d("div",Ft,o(l.$t("searchScope")),1),a(Fe,{"auto-size":{maxRows:8},value:C.value,"onUpdate:value":s[10]||(s[10]=n=>C.value=n),placeholder:l.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),d("div",Ut,[e(g).length?(u(),_(M,{key:0,onClick:e(be)},{default:t(()=>[i(o(l.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"])):v("",!0),e(g).length?(u(),_(M,{key:1,onClick:e(ke)},{default:t(()=>[i(o(l.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])):v("",!0),a(M,{onClick:s[11]||(s[11]=n=>x.value=!0)},{default:t(()=>[i(o(l.$t("history")),1)]),_:1})]),a(De,{size:"large",spinning:!e(b).isIdle},{default:t(()=>[a(Ve,{visible:e(R),"onUpdate:visible":s[13]||(s[13]=n=>ie(R)?R.value=n:null),width:"70vw","mask-closable":"",onOk:s[14]||(s[14]=n=>R.value=!1)},{cancelText:t(()=>[]),default:t(()=>[a(Ue,{active:"",loading:!e(me).isIdle},{default:t(()=>[d("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:s[12]||(s[12]=n=>e(Ze)(e(X)))},[d("div",Vt,o(l.$t("doubleClickToCopy")),1),i(" "+o(e(X)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),j.value===0&&!e(g).length&&e(U).getRecords().length?(u(),z("div",Dt,[d("h2",Bt,o(l.$t("restoreFromHistory")),1),a(de,{records:e(U),onReuseRecord:ee},{default:t(({record:n})=>[d("div",Et,[a(y,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[i(o(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(u(),_(y,{key:0},{default:t(()=>[a(r,{span:4},{default:t(()=>[i(o(l.$t("searchScope"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[i(o(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):v("",!0),a(y,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[i(o(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[i(o(n.isRegex),1)]),_:2},1024)]),_:2},1024),n.mediaType?(u(),_(y,{key:1},{default:t(()=>[a(r,{span:4},{default:t(()=>[i(o(l.$t("mediaType"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[i(o(n.mediaType),1)]),_:2},1024)]),_:2},1024)):v("",!0),a(y,null,{default:t(()=>[a(r,{span:4},{default:t(()=>[i(o(l.$t("time"))+":",1)]),_:1}),a(r,{span:20},{default:t(()=>[i(o(n.time),1)]),_:2},1024)]),_:2},1024),Ht])]),_:1},8,["records"])])):v("",!0),e(g)?(u(),_(e(ct),{key:1,ref_key:"scroller",ref:Y,class:"file-list",items:e(g),"item-size":e(Q).first,"key-field":"fullpath","item-secondary-size":e(Q).second,gridItems:e(ve),onScroll:e(Z)},{after:t(()=>[Pt]),default:t(({item:n,index:ae})=>[a(ft,{idx:ae,file:n,"show-menu-idx":e(B),"onUpdate:showMenuIdx":s[15]||(s[15]=le=>ie(B)?B.value=le:null),onFileItemClick:e(ge),"full-screen-preview-image-url":e(g)[e($)]?e(et)(e(g)[e($)]):"","cell-width":e(ye),selected:e(D).includes(ae),onContextMenuClick:e(q),onDragstart:e(_e),onDragend:e(he),onTiktokView:(le,Be)=>e(bt)(e(g),Be),"enable-change-indicator":e(Se),"seed-change-checked":e(Ce),"get-gen-diff":e(xe),"get-gen-diff-watch-dep":e(Ie),"is-selected-mutil-files":e(D).length>1,onPreviewVisibleChange:e(fe)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","onTiktokView","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):v("",!0),e(N)?(u(),z("div",Gt,[a(e(mt),{onClick:s[16]||(s[16]=n=>e(J)("prev")),class:F({disable:!e(W)("prev")})},null,8,["class"]),a(e(gt),{onClick:s[17]||(s[17]=n=>e(J)("next")),class:F({disable:!e(W)("next")})},null,8,["class"])])):v("",!0)]),_:1},8,["spinning"]),e(N)&&e(g)&&e(g)[e($)]?(u(),_(_t,{key:2,file:e(g)[e($)],idx:e($),onContextMenuClick:e(q)},null,8,["file","idx","onContextMenuClick"])):v("",!0)],512)],64)}}});const ta=pt(Kt,[["__scopeId","data-v-9726dd9e"]]);export{ta as default};
