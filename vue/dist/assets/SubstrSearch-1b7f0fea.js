import{c as a,A as Ee,d as Pe,bm as He,aC as Ge,r as w,v as Ke,bq as se,s as Le,bs as je,bt as qe,x as Ne,W as Je,X as We,br as ne,bu as Qe,p as Xe,o as p,j as z,C as t,E as e,k as d,l as o,t as i,B as _,m as g,G,bC as Ze,V as U,F as ie,H as oe,I as Ye,U as et,Z as re,a3 as ue,av as tt,a2 as at,bD as lt,a0 as st,by as nt,a1 as it,a8 as ot,aw as rt,ax as ut,bE as dt,n as pt}from"./index-32743103.js";/* empty css              *//* empty css              */import{s as ct,F as ft}from"./FileItem-aa47825a.js";import{M as vt,L as gt,R as mt,f as _t}from"./MultiSelectKeep-56b94e1f.js";import{c as ht,u as yt}from"./hook-e2eaf999.js";import{g as bt,o as kt}from"./index-c80754a2.js";import{f as F,H as de,T as wt,_ as St,a as Ct}from"./TipsCarousel-4f02731b.js";import"./index-e1a70e12.js";import"./shortcut-3129f75b.js";import"./_isIterateeCall-16c5cf9c.js";var xt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"}},{tag:"path",attrs:{d:"M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"}}]},name:"aim",theme:"outlined"};const It=xt;function pe(c){for(var r=1;r<arguments.length;r++){var h=arguments[r]!=null?Object(arguments[r]):{},b=Object.keys(h);typeof Object.getOwnPropertySymbols=="function"&&(b=b.concat(Object.getOwnPropertySymbols(h).filter(function(v){return Object.getOwnPropertyDescriptor(h,v).enumerable}))),b.forEach(function(v){$t(c,v,h[v])})}return c}function $t(c,r,h){return r in c?Object.defineProperty(c,r,{value:h,enumerable:!0,configurable:!0,writable:!0}):c[r]=h,c}var K=function(r,h){var b=pe({},r,h.attrs);return a(Ee,pe({},b,{icon:It}),null)};K.displayName="AimOutlined";K.inheritAttrs=!1;const At=K,Rt="/infinite_image_browsing/fe-static/assets/regex-a447f877.svg",L=c=>(rt("data-v-4584136c"),c=c(),ut(),c),Tt={style:{"padding-right":"16px"}},Ot=L(()=>d("div",null,null,-1)),Mt=["title"],zt=["src"],Ut={class:"search-bar"},Ft={class:"form-name"},Dt={class:"search-bar last actions"},Vt={class:"tips-wrapper"},Bt={class:"hint"},Et={key:0,style:{margin:"64px 16px 32px",padding:"8px",background:"var(--zp-secondary-variant-background)","border-radius":"16px"}},Pt={style:{margin:"16px 32px 16px"}},Ht={style:{"padding-right":"16px"}},Gt=L(()=>d("div",null,null,-1)),Kt=L(()=>d("div",{style:{padding:"16px 0 512px"}},null,-1)),Lt={key:2,class:"preview-switch"},jt=Pe({__name:"SubstrSearch",props:{tabIdx:{},paneIdx:{},searchScope:{},initialSubstr:{},initialIsRegex:{type:Boolean},initialPathOnly:{type:Boolean},initialMediaType:{},autoSearch:{type:Boolean}},setup(c){const r=c,h=He(),b=Ge("iib_auto_update_feature_tip_shown",!1),v=w(!1),S=w(""),x=w(!1),I=w(r.searchScope??""),$=w(!1),j=w(0),C=w("all"),D=ht(l=>{const s={cursor:l,regexp:v.value?S.value:"",surstr:v.value?"":S.value,path_only:x.value,folder_paths:(I.value??"").split(/,|\n/).map(u=>u.trim()).filter(u=>u),media_type:C.value};return dt(s)}),{queue:k,images:m,onContextMenuClickU:q,stackViewEl:ce,previewIdx:A,previewing:N,onPreviewVisibleChange:fe,previewImgMove:J,canPreview:W,itemSize:Q,gridItems:ve,showGenInfo:T,imageGenInfo:X,q:ge,multiSelectedIdxs:V,onFileItemClick:me,scroller:Z,showMenuIdx:B,onFileDragStart:_e,onFileDragEnd:he,cellWidth:ye,onScroll:Y,saveAllFileAsJson:be,saveLoadedFileAsJson:ke,props:we,changeIndchecked:Se,seedChangeChecked:Ce,getGenDiff:xe,getGenDiffWatchDep:Ie}=yt(D),f=w();Ke(async()=>{f.value=await se(),f.value.img_count&&f.value.expired&&O.autoUpdateIndex&&await E(),r.initialSubstr!==void 0&&(S.value=r.initialSubstr),r.initialIsRegex!==void 0&&(v.value=r.initialIsRegex),r.initialPathOnly!==void 0&&(x.value=r.initialPathOnly),r.initialMediaType!==void 0&&(C.value=r.initialMediaType),r.initialSubstr&&r.autoSearch!==!1?await R():r.searchScope&&!r.initialSubstr&&await R()}),Le(()=>r,async l=>{we.value=l},{deep:!0,immediate:!0});const E=je(()=>k.pushAction(async()=>(await qe(),f.value=await se(),h.tagMap.clear(),f.value)).res),ee=l=>{S.value=l.substr,I.value=l.folder_paths_str,v.value=l.isRegex,C.value=l.mediaType||"all",$.value=!1,R()},R=async()=>{j.value++,F.value.add({substr:S.value,folder_paths_str:I.value,isRegex:v.value,mediaType:C.value}),await D.reset({refetch:!0}),await Ne(),Y(),Z.value.scrollToItem(0),m.value.length||Je.info(We("fuzzy-search-noResults"))};ne("returnToIIB",async()=>{const l=await k.pushAction(Qe).res;f.value.expired=l.expired}),ne("searchIndexExpired",()=>f.value&&(f.value.expired=!0));const $e=()=>{v.value=!v.value},O=Xe(),{onClearAllSelected:Ae,onSelectAll:Re,onReverseSelect:Te}=bt();return(l,s)=>{const u=St,y=Ct,Oe=re,M=ue,te=tt,Me=at,P=lt,ze=st,H=ue,Ue=nt,Fe=it,De=re,Ve=ot;return p(),z(ie,null,[a(Oe,{visible:$.value,"onUpdate:visible":s[0]||(s[0]=n=>$.value=n),width:"70vw","mask-closable":"",onOk:s[1]||(s[1]=n=>$.value=!1)},{default:t(()=>[a(de,{records:e(F),onReuseRecord:ee},{default:t(({record:n})=>[d("div",Tt,[a(y,null,{default:t(()=>[a(u,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),a(u,{span:20},{default:t(()=>[o(i(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(p(),_(y,{key:0},{default:t(()=>[a(u,{span:4},{default:t(()=>[o(i(l.$t("searchScope"))+":",1)]),_:1}),a(u,{span:20},{default:t(()=>[o(i(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):g("",!0),a(y,null,{default:t(()=>[a(u,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),a(u,{span:20},{default:t(()=>[o(i(n.isRegex),1)]),_:2},1024)]),_:2},1024),n.mediaType?(p(),_(y,{key:1},{default:t(()=>[a(u,{span:4},{default:t(()=>[o(i(l.$t("mediaType"))+":",1)]),_:1}),a(u,{span:20},{default:t(()=>[o(i(n.mediaType),1)]),_:2},1024)]),_:2},1024)):g("",!0),a(y,null,{default:t(()=>[a(u,{span:4},{default:t(()=>[o(i(l.$t("time"))+":",1)]),_:1}),a(u,{span:20},{default:t(()=>[o(i(n.time),1)]),_:2},1024)]),_:2},1024),Ot])]),_:1},8,["records"])]),_:1},8,["visible"]),d("div",{class:"container",ref_key:"stackViewEl",ref:ce},[e(b)?g("",!0):(p(),_(te,{key:0,type:"info","show-icon":"",message:l.$t("autoUpdateFeatureTip"),style:{margin:"8px"},closable:"",onClose:s[3]||(s[3]=n=>b.value=!0)},{action:t(()=>[a(M,{size:"small",type:"link",onClick:s[2]||(s[2]=n=>b.value=!0)},{default:t(()=>[o(i(l.$t("gotIt")),1)]),_:1})]),_:1},8,["message"])),f.value&&f.value.expired&&!e(O).autoUpdateIndex?(p(),_(te,{key:1,type:"warning","show-icon":"",message:l.$t("indexExpiredManualUpdate"),style:{margin:"8px"},closable:""},null,8,["message"])):g("",!0),a(vt,{show:!!e(V).length||e(O).keepMultiSelect,onClearAllSelected:e(Ae),onSelectAll:e(Re),onReverseSelect:e(Te)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),d("div",{class:"search-bar",onKeydown:s[9]||(s[9]=G(()=>{},["stop"]))},[a(Me,{value:S.value,"onUpdate:value":s[4]||(s[4]=n=>S.value=n),placeholder:l.$t("fuzzy-search-placeholder")+" "+l.$t("regexSearchEnabledHint"),disabled:!e(k).isIdle,onKeydown:Ze(R,["enter"]),"allow-clear":""},null,8,["value","placeholder","disabled","onKeydown"]),a(ze,{value:C.value,"onUpdate:value":s[5]||(s[5]=n=>C.value=n),style:{width:"100px",margin:"0 4px"},disabled:!e(k).isIdle},{default:t(()=>[a(P,{value:"all"},{default:t(()=>[o(i(l.$t("all")),1)]),_:1}),a(P,{value:"image"},{default:t(()=>[o(i(l.$t("image")),1)]),_:1}),a(P,{value:"video"},{default:t(()=>[o(i(l.$t("video")),1)]),_:1})]),_:1},8,["value","disabled"]),d("div",{class:U(["regex-icon",{selected:x.value}]),onKeydown:s[6]||(s[6]=G(()=>{},["stop"])),onClick:s[7]||(s[7]=n=>x.value=!x.value),title:l.$t("pathOnly")},[a(e(At))],42,Mt),d("div",{class:U(["regex-icon",{selected:v.value}]),onKeydown:s[8]||(s[8]=G(()=>{},["stop"])),onClick:$e,title:"Use Regular Expression"},[d("img",{src:e(Rt)},null,8,zt)],34),f.value&&!f.value.img_count?(p(),_(H,{key:0,onClick:e(E),loading:!e(k).isIdle,type:"primary"},{default:t(()=>[o(i(l.$t("generateIndexHint")),1)]),_:1},8,["onClick","loading"])):(p(),z(ie,{key:1},[a(H,{type:"primary",onClick:R,loading:!e(k).isIdle||e(D).loading},{default:t(()=>[o(i(l.$t("search")),1)]),_:1},8,["loading"]),f.value&&f.value.expired&&!e(O).autoUpdateIndex?(p(),_(H,{key:0,onClick:e(E),loading:!e(k).isIdle,style:{"margin-left":"8px"}},{default:t(()=>[o(i(l.$t("UpdateIndex")),1)]),_:1},8,["onClick","loading"])):g("",!0)],64))],32),d("div",Ut,[d("div",Ft,i(l.$t("searchScope")),1),a(Ue,{"auto-size":{maxRows:8},value:I.value,"onUpdate:value":s[10]||(s[10]=n=>I.value=n),placeholder:l.$t("specifiedSearchFolder")},null,8,["value","placeholder"])]),d("div",Dt,[e(m).length?(p(),_(M,{key:0,onClick:e(ke)},{default:t(()=>[o(i(l.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"])):g("",!0),e(m).length?(p(),_(M,{key:1,onClick:e(be)},{default:t(()=>[o(i(l.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])):g("",!0),a(M,{onClick:s[11]||(s[11]=n=>$.value=!0)},{default:t(()=>[o(i(l.$t("history")),1)]),_:1}),d("div",Vt,[a(wt,{interval:1e4})])]),a(Ve,{size:"large",spinning:!e(k).isIdle},{default:t(()=>[a(De,{visible:e(T),"onUpdate:visible":s[13]||(s[13]=n=>oe(T)?T.value=n:null),width:"70vw","mask-closable":"",onOk:s[14]||(s[14]=n=>T.value=!1)},{cancelText:t(()=>[]),default:t(()=>[a(Fe,{active:"",loading:!e(ge).isIdle},{default:t(()=>[d("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:s[12]||(s[12]=n=>e(Ye)(e(X)))},[d("div",Bt,i(l.$t("doubleClickToCopy")),1),o(" "+i(e(X)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),j.value===0&&!e(m).length&&e(F).getRecords().length?(p(),z("div",Et,[d("h2",Pt,i(l.$t("restoreFromHistory")),1),a(de,{records:e(F),onReuseRecord:ee},{default:t(({record:n})=>[d("div",Ht,[a(y,null,{default:t(()=>[a(u,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsSubstr"))+":",1)]),_:1}),a(u,{span:20},{default:t(()=>[o(i(n.substr),1)]),_:2},1024)]),_:2},1024),n.folder_paths_str?(p(),_(y,{key:0},{default:t(()=>[a(u,{span:4},{default:t(()=>[o(i(l.$t("searchScope"))+":",1)]),_:1}),a(u,{span:20},{default:t(()=>[o(i(n.folder_paths_str),1)]),_:2},1024)]),_:2},1024)):g("",!0),a(y,null,{default:t(()=>[a(u,{span:4},{default:t(()=>[o(i(l.$t("historyRecordsisRegex"))+":",1)]),_:1}),a(u,{span:20},{default:t(()=>[o(i(n.isRegex),1)]),_:2},1024)]),_:2},1024),n.mediaType?(p(),_(y,{key:1},{default:t(()=>[a(u,{span:4},{default:t(()=>[o(i(l.$t("mediaType"))+":",1)]),_:1}),a(u,{span:20},{default:t(()=>[o(i(n.mediaType),1)]),_:2},1024)]),_:2},1024)):g("",!0),a(y,null,{default:t(()=>[a(u,{span:4},{default:t(()=>[o(i(l.$t("time"))+":",1)]),_:1}),a(u,{span:20},{default:t(()=>[o(i(n.time),1)]),_:2},1024)]),_:2},1024),Gt])]),_:1},8,["records"])])):g("",!0),e(m)?(p(),_(e(ct),{key:1,ref_key:"scroller",ref:Z,class:"file-list",items:e(m),"item-size":e(Q).first,"key-field":"fullpath","item-secondary-size":e(Q).second,gridItems:e(ve),onScroll:e(Y)},{after:t(()=>[Kt]),default:t(({item:n,index:ae})=>[a(ft,{idx:ae,file:n,"show-menu-idx":e(B),"onUpdate:showMenuIdx":s[15]||(s[15]=le=>oe(B)?B.value=le:null),onFileItemClick:e(me),"full-screen-preview-image-url":e(m)[e(A)]?e(et)(e(m)[e(A)]):"","cell-width":e(ye),selected:e(V).includes(ae),onContextMenuClick:e(q),onDragstart:e(_e),onDragend:e(he),onTiktokView:(le,Be)=>e(kt)(e(m),Be),"enable-change-indicator":e(Se),"seed-change-checked":e(Ce),"get-gen-diff":e(xe),"get-gen-diff-watch-dep":e(Ie),"is-selected-mutil-files":e(V).length>1,onPreviewVisibleChange:e(fe)},null,8,["idx","file","show-menu-idx","onFileItemClick","full-screen-preview-image-url","cell-width","selected","onContextMenuClick","onDragstart","onDragend","onTiktokView","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep","is-selected-mutil-files","onPreviewVisibleChange"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):g("",!0),e(N)?(p(),z("div",Lt,[a(e(gt),{onClick:s[16]||(s[16]=n=>e(J)("prev")),class:U({disable:!e(W)("prev")})},null,8,["class"]),a(e(mt),{onClick:s[17]||(s[17]=n=>e(J)("next")),class:U({disable:!e(W)("next")})},null,8,["class"])])):g("",!0)]),_:1},8,["spinning"]),e(N)&&e(m)&&e(m)[e(A)]?(p(),_(_t,{key:2,file:e(m)[e(A)],idx:e(A),onContextMenuClick:e(q)},null,8,["file","idx","onContextMenuClick"])):g("",!0)],512)],64)}}});const la=pt(jt,[["__scopeId","data-v-4584136c"]]);export{la as default};
