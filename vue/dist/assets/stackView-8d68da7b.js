import{d as Z,u as we,g as X,_ as qe,c as r,a as ye,P as le,D as Ce,f as He,w as It,b as At,e as Pt,h as Ne,M as be,i as xt,A as Rt,o as g,j as x,k as l,l as V,t as p,F as _e,m as N,n as Ke,p as Mt,q as Tt,r as Bt,s as ge,v as Ot,x as Le,y as ze,z as Dt,B as O,C as i,E as e,G as d,H as D,I as Nt,J as Lt,K as Ee,L as zt,N as Et,O as Vt,S as jt,Q as Ut,R as Wt,T as Gt,U as qt,V as Ve,W as A,X as $,Y as je,Z as ke,$ as E,a0 as Ht,a1 as Kt,a2 as Qt,a3 as Jt,a4 as Xt,a5 as Yt,a6 as Zt,a7 as en,a8 as tn}from"./index-5573ae38.js";import{_ as nn}from"./shortcut-f44c6c9d.js";import{D as Qe}from"./index-5e569728.js";/* empty css              *//* empty css              */import{u as on,a as an,b as rn,c as ln,d as sn,e as dn,f as un,g as cn,h as pn,s as fn,o as Ue}from"./index-de6cda7b.js";import{s as vn,F as mn}from"./FileItem-ab6bf09c.js";import{M as gn,L as kn,R as yn,f as Cn}from"./MultiSelectKeep-e448072f.js";import"./_isIterateeCall-bb321415.js";var bn=["class","style"],_n=function(){return{prefixCls:String,href:String,separator:le.any,overlay:le.any,onClick:Function}};const Y=Z({compatConfig:{MODE:3},name:"ABreadcrumbItem",inheritAttrs:!1,__ANT_BREADCRUMB_ITEM:!0,props:_n(),slots:["separator","overlay"],setup:function(a,u){var f=u.slots,v=u.attrs,S=we("breadcrumb",a),C=S.prefixCls,P=function(F,m){var c=X(f,a,"overlay");return c?r(Qe,{overlay:c,placement:"bottom"},{default:function(){return[r("span",{class:"".concat(m,"-overlay-link")},[F,r(Ce,null,null)])]}}):F};return function(){var w,F=(w=X(f,a,"separator"))!==null&&w!==void 0?w:"/",m=X(f,a),c=v.class,b=v.style,k=qe(v,bn),y;return a.href!==void 0?y=r("a",ye({class:"".concat(C.value,"-link"),onClick:a.onClick},k),[m]):y=r("span",ye({class:"".concat(C.value,"-link"),onClick:a.onClick},k),[m]),y=P(y,C.value),m?r("span",{class:c,style:b},[y,F&&r("span",{class:"".concat(C.value,"-separator")},[F])]):null}}});var hn=function(){return{prefixCls:String,routes:{type:Array},params:le.any,separator:le.any,itemRender:{type:Function}}};function wn(s,a){if(!s.breadcrumbName)return null;var u=Object.keys(a).join("|"),f=s.breadcrumbName.replace(new RegExp(":(".concat(u,")"),"g"),function(v,S){return a[S]||v});return f}function We(s){var a=s.route,u=s.params,f=s.routes,v=s.paths,S=f.indexOf(a)===f.length-1,C=wn(a,u);return S?r("span",null,[C]):r("a",{href:"#/".concat(v.join("/"))},[C])}const G=Z({compatConfig:{MODE:3},name:"ABreadcrumb",props:hn(),slots:["separator","itemRender"],setup:function(a,u){var f=u.slots,v=we("breadcrumb",a),S=v.prefixCls,C=v.direction,P=function(c,b){return c=(c||"").replace(/^\//,""),Object.keys(b).forEach(function(k){c=c.replace(":".concat(k),b[k])}),c},w=function(c,b,k){var y=xt(c),I=P(b||"",k);return I&&y.push(I),y},F=function(c){var b=c.routes,k=b===void 0?[]:b,y=c.params,I=y===void 0?{}:y,L=c.separator,R=c.itemRender,T=R===void 0?We:R,z=[];return k.map(function(h){var B=P(h.path,I);B&&z.push(B);var q=[].concat(z),H=null;return h.children&&h.children.length&&(H=r(be,null,{default:function(){return[h.children.map(function(j){return r(be.Item,{key:j.path||j.breadcrumbName},{default:function(){return[T({route:j,params:I,routes:k,paths:w(q,j.path,I)})]}})})]}})),r(Y,{overlay:H,separator:L,key:B||h.breadcrumbName},{default:function(){return[T({route:h,params:I,routes:k,paths:q})]}})})};return function(){var m,c,b,k=a.routes,y=a.params,I=y===void 0?{}:y,L=He(X(f,a)),R=(m=X(f,a,"separator"))!==null&&m!==void 0?m:"/",T=a.itemRender||f.itemRender||We;k&&k.length>0?b=F({routes:k,params:I,separator:R,itemRender:T}):L.length&&(b=L.map(function(h,B){return It(At(h.type)==="object"&&(h.type.__ANT_BREADCRUMB_ITEM||h.type.__ANT_BREADCRUMB_SEPARATOR),"Breadcrumb","Only accepts Breadcrumb.Item and Breadcrumb.Separator as it's children"),Pt(h,{separator:R,key:B})}));var z=(c={},Ne(c,S.value,!0),Ne(c,"".concat(S.value,"-rtl"),C.value==="rtl"),c);return r("div",{class:z},[b])}}});var Sn=["separator","class"],$n=function(){return{prefixCls:String}};const he=Z({compatConfig:{MODE:3},name:"ABreadcrumbSeparator",__ANT_BREADCRUMB_SEPARATOR:!0,inheritAttrs:!1,props:$n(),setup:function(a,u){var f=u.slots,v=u.attrs,S=we("breadcrumb",a),C=S.prefixCls;return function(){var P;v.separator;var w=v.class,F=qe(v,Sn),m=He((P=f.default)===null||P===void 0?void 0:P.call(f));return r("span",ye({class:["".concat(C.value,"-separator"),w]},F),[m.length>0?m:"/"])}}});G.Item=Y;G.Separator=he;G.install=function(s){return s.component(G.name,G),s.component(Y.name,Y),s.component(he.name,he),s};var Fn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"};const In=Fn;function Ge(s){for(var a=1;a<arguments.length;a++){var u=arguments[a]!=null?Object(arguments[a]):{},f=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(f=f.concat(Object.getOwnPropertySymbols(u).filter(function(v){return Object.getOwnPropertyDescriptor(u,v).enumerable}))),f.forEach(function(v){An(s,v,u[v])})}return s}function An(s,a,u){return a in s?Object.defineProperty(s,a,{value:u,enumerable:!0,configurable:!0,writable:!0}):s[a]=u,s}var Se=function(a,u){var f=Ge({},a,u.attrs);return r(Rt,Ge({},f,{icon:In}),null)};Se.displayName="ArrowLeftOutlined";Se.inheritAttrs=!1;const Pn=Se;const xn={class:"base-info"},Rn=Z({__name:"BaseFileListInfo",props:{fileNum:{},selectedFileNum:{}},setup(s){return(a,u)=>(g(),x("div",xn,[l("span",null,[V(p(a.$t("items",[a.fileNum]))+" ",1),a.selectedFileNum?(g(),x(_e,{key:0},[V(", "+p(a.$t("selectedItems",[a.selectedFileNum])),1)],64)):N("",!0)])]))}});const Mn=Ke(Rn,[["__scopeId","data-v-afd25667"]]),Tn={class:"hint"},Bn={class:"location-bar"},On=["onClick"],Dn={key:3,class:"location-act"},Nn={class:"actions"},Ln=["onClick"],zn=["title"],En=["onClick"],Vn={style:{width:"512px",background:"var(--zp-primary-background)",padding:"16px","border-radius":"4px","box-shadow":"0 0 4px var(--zp-secondary-background)",border:"1px solid var(--zp-secondary-background)"}},jn={style:{padding:"4px"}},Un={style:{padding:"4px"}},Wn={style:{padding:"4px"}},Gn={key:0,style:{padding:"4px"}},qn={style:{padding:"4px"}},Hn={style:{padding:"4px"}},Kn=["onClick"],Qn={key:0,class:"view"},Jn={style:{padding:"16px 0 512px"}},Xn={key:0,class:"preview-switch"},Yn=Z({__name:"stackView",props:{tabIdx:{},paneIdx:{},path:{},mode:{},targetFile:{},openPreview:{type:Boolean},stackKey:{}},setup(s){const a=s,u=Mt(),{scroller:f,stackViewEl:v,props:S,multiSelectedIdxs:C,spinning:P}=on().toRefs();f.value,v.value;const{currLocation:w,currPage:F,refresh:m,copyLocation:c,back:b,openNext:k,stack:y,quickMoveTo:I,addToSearchScanPathAndQuickMove:L,locInputValue:R,isLocationEditing:T,onLocEditEnter:z,onEditBtnClick:h,share:B,selectAll:q,onCreateFloderBtnClick:H,onWalkBtnClick:ee,showWalkButton:j,searchInCurrentDir:se,backToLastUseTo:$e,polling:Je,onPollRefreshClick:Fe}=an(),{gridItems:Xe,sortMethodConv:Ye,moreActionsDropdownShow:te,sortedFiles:M,sortMethod:ie,itemSize:Ie,loadNextDir:Ze,loadNextDirLoading:et,canLoadNext:tt,onScroll:nt,cellWidth:ne,dirCoverCache:ot}=rn(),{onDrop:Ae,onFileDragStart:at,onFileDragEnd:rt,onFileDropToFolder:lt}=ln(),{onFileItemClick:st,onContextMenuClick:Pe,showGenInfo:oe,imageGenInfo:xe,q:it}=sn({openNext:k}),{previewIdx:K,onPreviewVisibleChange:dt,previewing:de,previewImgMove:Re,canPreview:Me,scrollToFileId:ut,scrollToIndex:ct}=dn(),Te=Tt(),{showMenuIdx:ue}=un(),{onClearAllSelected:pt,onReverseSelect:ft,onSelectAll:vt}=cn(),{getGenDiff:mt,changeIndchecked:Q,seedChangeChecked:ae,getRawGenParams:gt,getGenDiffWatchDep:kt}=pn(),yt=async(o,t)=>{await lt(o,t)||await Ae(o)},Ct=()=>{M.value.length!==0&&Ue(M.value,K.value||0)},ce=Bt(!1),bt=async()=>{te.value=!1,ce.value=!0;let o;try{A.loading({content:$("flattenFolderScanning"),key:"flatten",duration:0}),o=await je({folder_path:w.value,dry_run:!0})}catch(t){A.destroy("flatten"),A.error(t.message||String(t)),ce.value=!1;return}if(A.destroy("flatten"),ce.value=!1,o.total_files===0){A.info($("flattenFolderNoFiles"));return}if(o.conflicts.length>0){ke.error({title:$("flattenFolderConflict"),content:E("div",{},[E("p",{},`${$("flattenFolderConflictFiles")}:`),E("ul",{style:"max-height: 300px; overflow-y: auto;"},o.conflicts.map(t=>E("li",{style:"color: red;"},t)))])});return}ke.confirm({title:$("flattenFolder"),content:E("div",{},[E("p",{style:"color: red; font-weight: bold;"},$("flattenFolderWarning")),E("p",{},$("flattenFolderConfirm",{count:o.total_files}))]),okText:$("confirm"),okType:"danger",cancelText:$("cancel"),onOk:async()=>{var t;try{A.loading({content:$("flattenFolderExecuting"),key:"flatten",duration:0});const _=await je({folder_path:w.value,dry_run:!1});A.destroy("flatten"),_.success?(A.success($("flattenFolderSuccess",{count:_.moved_files})),m()):A.error(`${$("error")}: ${(t=_.errors)==null?void 0:t.join(", ")}`)}catch(_){A.destroy("flatten"),A.error(_.message||String(_))}}})};return ge(()=>a,()=>{S.value=a;const o=fn.get(a.stackKey??"");o&&(y.value=o.slice())},{immediate:!0}),ge(()=>Te.visible,(o,t)=>{if(!o&&t){const _=Te.lastActiveId;_&&ut(_)}}),Ot(()=>{const{targetFile:o,openPreview:t}=a;!o||!t||(console.log("StackView mounted with targetFile:",o,"openPreview:",t),Le(()=>{const _=ge(()=>M.value,J=>{if(J&&J.length>0){const U=J.map(pe=>ze(pe.fullpath)).indexOf(ze(o));U!==-1&&(_(),Le(()=>{console.log("Found target file in stack view:",o,"at index",U),ct(U),setTimeout(()=>{Dt(U,v.value)},300)}))}},{immediate:!0});setTimeout(()=>{_()},5e3)}))}),(o,t)=>{const _=Ht,J=Kt,U=ke,pe=Qt,_t=Y,ht=G,Be=Jt,fe=Xt,Oe=be,ve=Qe,wt=nn,re=Yt,De=Zt,St=en,$t=tn;return g(),O($t,{spinning:e(P),size:"large"},{default:i(()=>[r(gn,{show:e(u).keepMultiSelect||!!e(C).length,onClearAllSelected:e(pt),onSelectAll:e(vt),onReverseSelect:e(ft)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),r(_,{style:{display:"none"}}),l("div",{ref_key:"stackViewEl",ref:v,onDragover:t[32]||(t[32]=d(()=>{},["prevent"])),onDrop:t[33]||(t[33]=d(n=>e(Ae)(n),["prevent"])),class:"container"},[r(U,{visible:e(oe),"onUpdate:visible":t[1]||(t[1]=n=>D(oe)?oe.value=n:null),width:"70vw","mask-closable":"",onOk:t[2]||(t[2]=n=>oe.value=!1)},{cancelText:i(()=>[]),default:i(()=>[r(J,{active:"",loading:!e(it).isIdle},{default:i(()=>[l("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto","z-index":"9999"},onDblclick:t[0]||(t[0]=n=>e(Nt)(e(xe)))},[l("div",Tn,p(o.$t("doubleClickToCopy")),1),V(" "+p(e(xe)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),l("div",Bn,[l("div",{class:"breadcrumb",style:Lt({flex:e(T)?1:""})},[e(T)?(g(),O(pe,{key:0,style:{flex:"1"},value:e(R),"onUpdate:value":t[3]||(t[3]=n=>D(R)?R.value=n:null),onClick:t[4]||(t[4]=d(()=>{},["stop"])),onKeydown:t[5]||(t[5]=d(()=>{},["stop"])),onPressEnter:e(z),"allow-clear":""},null,8,["value","onPressEnter"])):(g(),O(ht,{key:1,style:{flex:"1"}},{default:i(()=>[(g(!0),x(_e,null,Ee(e(y),(n,W)=>(g(),O(_t,{key:W},{default:i(()=>[l("a",{onClick:d(me=>e(b)(W),["prevent"])},p(n.curr==="/"?o.$t("root"):n.curr.replace(/:\/$/,o.$t("drive"))),9,On)]),_:2},1024))),128))]),_:1})),e(T)?(g(),O(Be,{key:2,size:"small",onClick:e(z),type:"primary"},{default:i(()=>[V(p(o.$t("go")),1)]),_:1},8,["onClick"])):(g(),x("div",Dn,[o.mode==="scanned-fixed"?(g(),x("a",{key:0,onClick:t[6]||(t[6]=d((...n)=>e($e)&&e($e)(...n),["prevent"])),style:{margin:"0 8px 16px 0"}},[r(e(Pn))])):N("",!0),l("a",{onClick:t[7]||(t[7]=d((...n)=>e(c)&&e(c)(...n),["prevent"])),class:"copy"},p(o.$t("copy")),1),l("a",{onClick:t[8]||(t[8]=d((...n)=>e(h)&&e(h)(...n),["prevent","stop"]))},p(o.$t("edit")),1)]))],4),l("div",Nn,[l("a",{class:"opt",onClick:t[9]||(t[9]=d((...n)=>e(m)&&e(m)(...n),["prevent"]))},p(o.$t("refresh")),1),l("a",{class:"opt",onClick:d(Ct,["prevent"])},p(o.$t("TikTok View")),9,Ln),l("a",{class:"opt",onClick:t[10]||(t[10]=d(n=>e(zt)(e(w)),["prevent"])),title:o.$t("smartOrganizeHint")},p(o.$t("smartOrganize")),9,zn),r(ve,null,{overlay:i(()=>[r(Oe,null,{default:i(()=>[r(fe,{key:"tag-search"},{default:i(()=>[l("a",{onClick:t[12]||(t[12]=d(n=>e(se)("tag-search"),["prevent"]))},p(o.$t("imgSearch")),1)]),_:1}),r(fe,{key:"tag-search"},{default:i(()=>[l("a",{onClick:t[13]||(t[13]=d(n=>e(se)("fuzzy-search"),["prevent"]))},p(o.$t("fuzzy-search")),1)]),_:1})]),_:1})]),default:i(()=>[l("a",{class:"opt",onClick:t[11]||(t[11]=d(()=>{},["prevent"]))},[V(p(o.$t("search"))+" ",1),r(e(Ce))])]),_:1}),e(j)?(g(),x("a",{key:0,class:"opt",onClick:t[14]||(t[14]=d((...n)=>e(ee)&&e(ee)(...n),["prevent"]))}," Walk ")):N("",!0),l("a",{class:"opt",onClick:t[15]||(t[15]=d((...n)=>e(q)&&e(q)(...n),["prevent","stop"]))},p(o.$t("selectAll")),1),r(ve,null,{overlay:i(()=>[r(Oe,null,{default:i(()=>[(g(!0),x(_e,null,Ee(e(u).quickMovePaths,n=>(g(),O(fe,{key:n.dir},{default:i(()=>[l("a",{onClick:d(W=>e(I)(n.dir),["prevent"])},p(n.zh),9,En)]),_:2},1024))),128))]),_:1})]),default:i(()=>[l("a",{class:"opt",onClick:t[16]||(t[16]=d(()=>{},["prevent"]))},[V(p(o.$t("quickMove"))+" ",1),r(e(Ce))])]),_:1}),r(ve,{trigger:["click"],visible:e(te),"onUpdate:visible":t[28]||(t[28]=n=>D(te)?te.value=n:null),placement:"bottomLeft",getPopupContainer:n=>n.parentNode},{overlay:i(()=>[l("div",Vn,[r(St,Et(Vt({labelCol:{span:10},wrapperCol:{span:14}})),{default:i(()=>[r(re,{label:o.$t("gridCellWidth")},{default:i(()=>[r(wt,{modelValue:e(ne),"onUpdate:modelValue":t[18]||(t[18]=n=>D(ne)?ne.value=n:null),max:1024,min:64,step:16},null,8,["modelValue"])]),_:1},8,["label"]),r(re,{label:o.$t("sortingMethod")},{default:i(()=>[r(e(jt),{value:e(ie),"onUpdate:value":t[19]||(t[19]=n=>D(ie)?ie.value=n:null),onClick:t[20]||(t[20]=d(()=>{},["stop"])),conv:e(Ye),options:e(Ut)},null,8,["value","conv","options"])]),_:1},8,["label"]),r(re,{label:o.$t("showChangeIndicators")},{default:i(()=>[r(De,{checked:e(Q),"onUpdate:checked":t[21]||(t[21]=n=>D(Q)?Q.value=n:null),onClick:e(gt)},null,8,["checked","onClick"])]),_:1},8,["label"]),r(re,{label:o.$t("seedAsChange")},{default:i(()=>[r(De,{checked:e(ae),"onUpdate:checked":t[22]||(t[22]=n=>D(ae)?ae.value=n:null),disabled:!e(Q)},null,8,["checked","disabled"])]),_:1},8,["label"]),l("div",jn,[l("a",{onClick:t[23]||(t[23]=d((...n)=>e(L)&&e(L)(...n),["prevent"]))},p(o.$t("addToSearchScanPathAndQuickMove")),1)]),l("div",Un,[l("a",{onClick:t[24]||(t[24]=d(n=>e(Wt)(e(w)+"/"),["prevent"]))},p(o.$t("openWithLocalFileBrowser")),1)]),l("div",Wn,[l("a",{onClick:t[25]||(t[25]=d((...n)=>e(Fe)&&e(Fe)(...n),["prevent"]))},p(e(Je)?o.$t("stopPollRefresh"):o.$t("pollRefresh")),1)]),e(Gt)?N("",!0):(g(),x("div",Gn,[l("a",{onClick:t[26]||(t[26]=d((...n)=>e(B)&&e(B)(...n),["prevent"]))},p(o.$t("share")),1)])),l("div",qn,[l("a",{onClick:t[27]||(t[27]=d((...n)=>e(H)&&e(H)(...n),["prevent"]))},p(o.$t("createFolder")),1)]),l("div",Hn,[l("a",{onClick:d(bt,["prevent"]),style:{color:"#ff4d4f"}},p(o.$t("flattenFolder")),9,Kn)])]),_:1},16)])]),default:i(()=>[l("a",{class:"opt",onClick:t[17]||(t[17]=d(()=>{},["prevent"]))},p(o.$t("more")),1)]),_:1},8,["visible","getPopupContainer"])])]),e(F)?(g(),x("div",Qn,[r(e(vn),{class:"file-list",items:e(M),ref_key:"scroller",ref:f,onScroll:e(nt),"item-size":e(Ie).first,"key-field":"fullpath","item-secondary-size":e(Ie).second,gridItems:e(Xe)},{default:i(({item:n,index:W})=>[r(mn,{idx:parseInt(W),file:n,"full-screen-preview-image-url":e(M)[e(K)]?e(qt)(e(M)[e(K)]):"","show-menu-idx":e(ue),"onUpdate:showMenuIdx":t[29]||(t[29]=me=>D(ue)?ue.value=me:null),selected:e(C).includes(W),"cell-width":e(ne),onFileItemClick:e(st),onDragstart:e(at),onDragend:e(rt),onPreviewVisibleChange:e(dt),onContextMenuClick:e(Pe),onDropToFolder:yt,onTiktokView:(me,Ft)=>e(Ue)(e(M),Ft),"is-selected-mutil-files":e(C).length>1,"enable-change-indicator":e(Q),"seed-change-checked":e(ae),"get-gen-diff":e(mt),"get-gen-diff-watch-dep":e(kt),previewing:e(de),"cover-files":e(ot).get(n.fullpath)},null,8,["idx","file","full-screen-preview-image-url","show-menu-idx","selected","cell-width","onFileItemClick","onDragstart","onDragend","onPreviewVisibleChange","onContextMenuClick","onTiktokView","is-selected-mutil-files","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep","previewing","cover-files"])]),after:i(()=>[l("div",Jn,[a.mode==="walk"?(g(),O(Be,{key:0,onClick:e(Ze),loading:e(et),block:"",type:"primary",disabled:!e(tt),ghost:""},{default:i(()=>[V(p(o.$t("loadNextPage")),1)]),_:1},8,["onClick","loading","disabled"])):N("",!0)])]),_:1},8,["items","onScroll","item-size","item-secondary-size","gridItems"]),e(de)?(g(),x("div",Xn,[r(e(kn),{onClick:t[30]||(t[30]=n=>e(Re)("prev")),class:Ve({disable:!e(Me)("prev")})},null,8,["class"]),r(e(yn),{onClick:t[31]||(t[31]=n=>e(Re)("next")),class:Ve({disable:!e(Me)("next")})},null,8,["class"])])):N("",!0)])):N("",!0)],544),e(de)?(g(),O(Cn,{key:0,file:e(M)[e(K)],idx:e(K),onContextMenuClick:e(Pe)},null,8,["file","idx","onContextMenuClick"])):N("",!0),r(Mn,{"file-num":e(M).length,"selected-file-num":e(C).length},null,8,["file-num","selected-file-num"])]),_:1},8,["spinning"])}}});const io=Ke(Yn,[["__scopeId","data-v-9516e28d"]]);export{io as default};
