import{d as ke,r as he,s as C,x as G,p as ve,o as u,j as S,c as n,E as e,C as o,H as z,k as d,I as we,t as a,l as p,B as U,U as Ie,aE as _e,m as b,V as E,a1 as Ce,Z as Se,a6 as be,a3 as N,a8 as xe,aw as ye,ax as Me,aK as Ae,n as Te}from"./index-32743103.js";import{L as Ve,R as $e,f as De,M as Fe}from"./MultiSelectKeep-56b94e1f.js";import{s as Be,F as Re}from"./FileItem-aa47825a.js";import{c as Ge,u as ze}from"./hook-e2eaf999.js";import{g as Ue,o as J}from"./index-c80754a2.js";/* empty css              */import"./index-e1a70e12.js";import"./shortcut-3129f75b.js";import"./_isIterateeCall-16c5cf9c.js";const Ee=c=>(ye("data-v-4815fec6"),c=c(),Me(),c),Ne={class:"hint"},Je={class:"action-bar"},Ke=Ee(()=>d("div",{style:{padding:"16px 0 512px"}},null,-1)),Le={key:1},Pe={class:"no-res-hint"},Oe={class:"hint"},We={key:2,class:"preview-switch"},qe=ke({__name:"MatchedImageGrid",props:{tabIdx:{},paneIdx:{},selectedTagIds:{},id:{}},setup(c){const k=c,m=he(!1),g=Ge(t=>Ae({...k.selectedTagIds,random_sort:m.value},t)),{queue:K,images:s,onContextMenuClickU:x,stackViewEl:L,previewIdx:r,previewing:y,onPreviewVisibleChange:P,previewImgMove:M,canPreview:A,itemSize:T,gridItems:O,showGenInfo:f,imageGenInfo:V,q:W,multiSelectedIdxs:h,onFileItemClick:q,scroller:v,showMenuIdx:w,onFileDragStart:j,onFileDragEnd:H,cellWidth:Q,onScroll:I,saveAllFileAsJson:Z,props:X,saveLoadedFileAsJson:Y,changeIndchecked:ee,seedChangeChecked:te,getGenDiff:le,getGenDiffWatchDep:ne}=ze(g);C(()=>k.selectedTagIds,async()=>{var t;await g.reset(),await G(),(t=v.value)==null||t.scrollToItem(0),I()},{immediate:!0}),C(m,async()=>{var t;await g.reset(),await G(),(t=v.value)==null||t.scrollToItem(0),I()}),C(()=>k,async t=>{X.value=t},{deep:!0,immediate:!0});const se=ve(),{onClearAllSelected:ie,onSelectAll:oe,onReverseSelect:ae}=Ue(),de=()=>{s.value.length!==0&&J(s.value,0)};return(t,l)=>{const ce=Fe,re=Ce,ue=Se,pe=be,_=N,me=N,ge=xe;return u(),S("div",{class:"container",ref_key:"stackViewEl",ref:L},[n(ce,{show:!!e(h).length||e(se).keepMultiSelect,onClearAllSelected:e(ie),onSelectAll:e(oe),onReverseSelect:e(ae)},null,8,["show","onClearAllSelected","onSelectAll","onReverseSelect"]),n(ge,{size:"large",spinning:!e(K).isIdle},{default:o(()=>{var $,D,F;return[n(ue,{visible:e(f),"onUpdate:visible":l[1]||(l[1]=i=>z(f)?f.value=i:null),width:"70vw","mask-closable":"",onOk:l[2]||(l[2]=i=>f.value=!1)},{cancelText:o(()=>[]),default:o(()=>[n(re,{active:"",loading:!e(W).isIdle},{default:o(()=>[d("div",{style:{width:"100%","word-break":"break-all","white-space":"pre-line","max-height":"70vh",overflow:"auto"},onDblclick:l[0]||(l[0]=i=>e(we)(e(V)))},[d("div",Ne,a(t.$t("doubleClickToCopy")),1),p(" "+a(e(V)),1)],32)]),_:1},8,["loading"])]),_:1},8,["visible"]),d("div",Je,[n(pe,{checked:m.value,"onUpdate:checked":l[3]||(l[3]=i=>m.value=i),"checked-children":t.$t("randomSort"),"un-checked-children":t.$t("sortByDate")},null,8,["checked","checked-children","un-checked-children"]),n(_,{onClick:de,disabled:!(($=e(s))!=null&&$.length)},{default:o(()=>[p(a(t.$t("tiktokView")),1)]),_:1},8,["disabled"]),n(_,{onClick:e(Y)},{default:o(()=>[p(a(t.$t("saveLoadedImageAsJson")),1)]),_:1},8,["onClick"]),n(_,{onClick:e(Z)},{default:o(()=>[p(a(t.$t("saveAllAsJson")),1)]),_:1},8,["onClick"])]),(D=e(s))!=null&&D.length?(u(),U(e(Be),{key:0,ref_key:"scroller",ref:v,class:"file-list",items:e(s),"item-size":e(T).first,"key-field":"fullpath","item-secondary-size":e(T).second,gridItems:e(O),onScroll:e(I)},{after:o(()=>[Ke]),default:o(({item:i,index:B})=>[n(Re,{idx:B,file:i,"cell-width":e(Q),"show-menu-idx":e(w),"onUpdate:showMenuIdx":l[4]||(l[4]=R=>z(w)?w.value=R:null),onDragstart:e(j),onDragend:e(H),onFileItemClick:e(q),onTiktokView:(R,fe)=>e(J)(e(s),fe),"full-screen-preview-image-url":e(s)[e(r)]?e(Ie)(e(s)[e(r)]):"",selected:e(h).includes(B),onContextMenuClick:e(x),onPreviewVisibleChange:e(P),"is-selected-mutil-files":e(h).length>1,"enable-change-indicator":e(ee),"seed-change-checked":e(te),"get-gen-diff":e(le),"get-gen-diff-watch-dep":e(ne)},null,8,["idx","file","cell-width","show-menu-idx","onDragstart","onDragend","onFileItemClick","onTiktokView","full-screen-preview-image-url","selected","onContextMenuClick","onPreviewVisibleChange","is-selected-mutil-files","enable-change-indicator","seed-change-checked","get-gen-diff","get-gen-diff-watch-dep"])]),_:1},8,["items","item-size","item-secondary-size","gridItems","onScroll"])):e(g).load&&t.selectedTagIds.and_tags.length===1&&!((F=t.selectedTagIds.folder_paths_str)!=null&&F.trim())?(u(),S("div",Le,[d("div",Pe,[d("p",Oe,a(t.$t("tagSearchNoResultsMessage")),1),n(me,{onClick:l[5]||(l[5]=i=>e(_e)()),type:"primary"},{default:o(()=>[p(a(t.$t("rebuildImageIndex")),1)]),_:1})])])):b("",!0),e(y)?(u(),S("div",We,[n(e(Ve),{onClick:l[6]||(l[6]=i=>e(M)("prev")),class:E({disable:!e(A)("prev")})},null,8,["class"]),n(e($e),{onClick:l[7]||(l[7]=i=>e(M)("next")),class:E({disable:!e(A)("next")})},null,8,["class"])])):b("",!0)]}),_:1},8,["spinning"]),e(y)&&e(s)&&e(s)[e(r)]?(u(),U(De,{key:0,file:e(s)[e(r)],idx:e(r),onContextMenuClick:e(x)},null,8,["file","idx","onContextMenuClick"])):b("",!0)],512)}}});const nt=Te(qe,[["__scopeId","data-v-4815fec6"]]);export{nt as default};
